<html>
<head>
    <!--https://apps.mypurecloud.com/crm/index.html?crm=salesforce&color=darkblue-->

    <!-- Imports Open CTI JavaScript library. Point to a valid Salesforce domain.-->
    <script src="https://maserati--devlex.sandbox.lightning.force.com/support/api/62.0/lightning/opencti_min.js"></script>
    <script type="text/javascript">

        var BARRA_MC_IN = "purecloud__ClientEvent__c";
        var BARRA_MC_OUT = "purecloud__ClientEvent__c";
        var BARRA_MC_IN_SUBSCRIPTION = null;


        function publishSampleMC(message) {
            sforce.opencti.publish({
                channelName: BARRA_MC_OUT,
                message: message,
                callback: lightningMessageServiceCallback
            });
        };

        function lightningMessageServiceCallback(result) {
            if (result.success) {
                console.log('Success publish');
            } else {
                console.log('Error: ' + result.errors);
            }
        };

        function startCall() {
            var message = {
                category: "add",
                data: {
                    id: "b78c9624-b319-433b-8c16-9091e474c233",
                    phone: "tel:+393356263742",
                    name: "+393356263742",
                    isConnected: false,
                    isDisconnected: false,
                    isDone: false,
                    state: "ALERTING",
                    isCallback: false,
                    isDialer: false,
                    isChat: false,
                    isEmail: false,
                    isMessage: false,
                    isVoicemail: false,
                    remoteName: "+393356263742",
                    recordingState: "active",
                    securePause: false,
                    displayAddress: "+393356263742",
                    queueName: "IT_IT_MASE_MAS_RelCli_O_27300",
                    ani: "+393356263742",
                    calledNumber: "+390244412855",
                    totalIvrDurationSeconds: 89,
                    direction: "Inbound",
                    isInternal: false
                },
                type:"Interaction"
            }
            publishSampleMC(message);
        }

        function endCall() {
            var message = {
                category:"disconnect",
                data:{
                    id:"10633d20-ff2f-4b44-bf3f-29f193116deb",
                    connectedTime:"2024-09-25T14:30:07.370Z",
                    endTime:"2024-09-25T14:40:19.961Z",
                    phone:"tel:+393334750325",
                    name:"+393334750325",
                    isConnected:false,
                    isDisconnected":true,
                    isDone:false,
                    state:"DISCONNECTED",
                    isCallback:false,
                    isDialer:false,
                    isChat:false,
                    isEmail:false,
                    isMessage:false,
                    isVoicemail:false,
                    remoteName:"+393334750325",
                    recordingState:"active",
                    securePause":false,
                    displayAddress:"+393334750325",
                    queueName:"IT_IT_MASE_MAS_RelCli_O_27300",
                    ani:"+393334750325",
                    calledNumber:"+390244412855",
                    interactionDurationSeconds:613,
                    totalIvrDurationSeconds:83,
                    direction:"Inbound",
                    isInternal:false,
                    startTime:"2024-09-25T14:28:44.016Z"
                },
                type:"Interaction"
            }
            publishSampleMC(message);
        }
    </script>
</head>
<body>
    <button onclick="startCall();">Simula chiamata iniziata</button><br/>
    <button onclick="endCall();">Simula chiamata finita</button><br/>
</body>
</html>
